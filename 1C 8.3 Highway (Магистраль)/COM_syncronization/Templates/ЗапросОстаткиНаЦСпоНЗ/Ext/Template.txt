ВЫБРАТЬ
	ТребованиеНакладнаяМатериалы.Номенклатура КАК Номенклатура,
	ВЫБОР
		КОГДА ТребованиеНакладнаяМатериалы.Номенклатура.Артикул = ""
			ТОГДА ПОДСТРОКА(ТребованиеНакладнаяМатериалы.Номенклатура.Комментарий, 0, 100)
		ИНАЧЕ ТребованиеНакладнаяМатериалы.Номенклатура.Артикул
	КОНЕЦ КАК ГОСТ,
	ТребованиеНакладнаяМатериалы.Номенклатура.ЕдиницаИзмерения КАК ЕдиницаИзмерения,
	СУММА(ТребованиеНакладнаяМатериалы.Количество) КАК Количество,
	ТребованиеНакладная.Склад КАК Склад,
	ТребованиеНакладная.Заказ КАК НарядЗаказ
ПОМЕСТИТЬ Резервы
ИЗ
	Документ.ТребованиеНакладная.Материалы КАК ТребованиеНакладнаяМатериалы
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ТребованиеНакладная КАК ТребованиеНакладная
		ПО ТребованиеНакладнаяМатериалы.Ссылка = ТребованиеНакладная.Ссылка
ГДЕ
	НЕ ТребованиеНакладная.ПометкаУдаления
	И НЕ ТребованиеНакладная.Проведен
	//И ТребованиеНакладная.Дата > &РезервС
	И ТребованиеНакладная.Дата > ДатаВремя(0001, 01, 01)
	И НЕ ТребованиеНакладная.Склад = ТребованиеНакладная.Субконто2

СГРУППИРОВАТЬ ПО
	ТребованиеНакладная.Склад,
	ТребованиеНакладнаяМатериалы.Номенклатура,
	ТребованиеНакладная.Заказ,
	ТребованиеНакладнаяМатериалы.Номенклатура.Код,
	ТребованиеНакладнаяМатериалы.Номенклатура.ЕдиницаИзмерения,
	ВЫБОР
		КОГДА ТребованиеНакладнаяМатериалы.Номенклатура.Артикул = ""
			ТОГДА ПОДСТРОКА(ТребованиеНакладнаяМатериалы.Номенклатура.Комментарий, 0, 100)
		ИНАЧЕ ТребованиеНакладнаяМатериалы.Номенклатура.Артикул
	КОНЕЦ
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ХозрасчетныйОстатки.Субконто1 КАК Субконто1,
	ХозрасчетныйОстатки.Субконто2 КАК Субконто2,
	ХозрасчетныйОстатки.Субконто3 КАК Субконто3,
	ХозрасчетныйОстатки.КоличествоОстаток КАК КоличествоОстаток,
	Номенклатура.Ссылка КАК Номенклатура,
	ВЫБОР
		КОГДА Номенклатура.Артикул = ""
			ТОГДА Номенклатура.Комментарий
		ИНАЧЕ Номенклатура.Артикул
	КОНЕЦ КАК ГОСТ,
	Номенклатура.ЕдиницаИзмерения КАК ЕдиницаИзмерения,
	Склады.Ссылка КАК Склад,
	НоменклатурныеГруппы.Ссылка КАК НарядЗаказ
ПОМЕСТИТЬ ОстаткиХз
ИЗ
	//РегистрБухгалтерии.Хозрасчетный.Остатки(&Период, Счет.Код ПОДОБНО "10%", , ) КАК ХозрасчетныйОстатки
	РегистрБухгалтерии.Хозрасчетный.Остатки(ДатаВремя(0001, 01, 01), Счет.Код ПОДОБНО "10%", , ) КАК ХозрасчетныйОстатки
	
	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК Номенклатура
		ПО ХозрасчетныйОстатки.Субконто1 = Номенклатура.Ссылка
	
	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК Склады
		ПО ХозрасчетныйОстатки.Субконто2 = Склады.Ссылка
	
	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.НоменклатурныеГруппы КАК НоменклатурныеГруппы
		ПО ХозрасчетныйОстатки.Субконто3 = НоменклатурныеГруппы.Ссылка
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ Первые 200
	ВЫБОР
		КОГДА ОстаткиХз.Субконто2 ЕСТЬ NULL
			ТОГДА Резервы.Склад.Наименование
		ИНАЧЕ ОстаткиХз.Склад.Наименование
	КОНЕЦ КАК СкладНаименование,
	ВЫБОР
		КОГДА ОстаткиХз.Субконто2 ЕСТЬ NULL
			ТОГДА Резервы.Склад.Код
		ИНАЧЕ ОстаткиХз.Склад.Код
	КОНЕЦ КАК СкладКод,
	ВЫБОР
		КОГДА ОстаткиХз.Субконто1 ЕСТЬ NULL
			ТОГДА Резервы.Номенклатура.Наименование
		ИНАЧЕ ОстаткиХз.Номенклатура.Наименование
	КОНЕЦ КАК НоменклатураНаименование,
	ВЫБОР
		КОГДА ОстаткиХз.Субконто1 ЕСТЬ NULL
			ТОГДА Резервы.Номенклатура.Код
		ИНАЧЕ ОстаткиХз.Номенклатура.Код
	КОНЕЦ КАК НоменклатураКод,
	ВЫБОР
		КОГДА ОстаткиХз.Субконто1 ЕСТЬ NULL
			ТОГДА Резервы.ЕдиницаИзмерения.Код
		ИНАЧЕ ОстаткиХз.ЕдиницаИзмерения.Код
	КОНЕЦ КАК ЕдиницаИзмеренияКод,
	ВЫБОР
		КОГДА ОстаткиХз.Субконто1 ЕСТЬ NULL
			ТОГДА Резервы.ГОСТ
		ИНАЧЕ ОстаткиХз.ГОСТ
	КОНЕЦ КАК ГОСТ,
	ВЫБОР
		КОГДА ОстаткиХз.Субконто3 ЕСТЬ NULL
			ТОГДА Резервы.НарядЗаказ.Код
		ИНАЧЕ ОстаткиХз.НарядЗаказ.Код
	КОНЕЦ КАК НарядЗаказКод,
	ВЫБОР
		КОГДА ОстаткиХз.Субконто3 ЕСТЬ NULL
			ТОГДА Резервы.НарядЗаказ.Наименование
		ИНАЧЕ ОстаткиХз.НарядЗаказ.Наименование
	КОНЕЦ КАК НарядЗаказНаименование,
	//ВЫБОР
	//	КОГДА Резервы.Количество ЕСТЬ NULL
	//		ТОГДА ОстаткиХз.КоличествоОстаток
	//	КОГДА ОстаткиХз.КоличествоОстаток ЕСТЬ NULL
	//		ТОГДА 0 - Резервы.Количество
	//	ИНАЧЕ ОстаткиХз.КоличествоОстаток - Резервы.Количество
	//КОНЕЦ КАК СвободныйОстаток,
	
	ОстаткиХз.КоличествоОстаток КАК Остаток,
	
	Резервы.Количество КАК Резерв
ИЗ
	ОстаткиХз КАК ОстаткиХз
	
	ПОЛНОЕ СОЕДИНЕНИЕ Резервы КАК Резервы
		ПО    ОстаткиХз.Номенклатура  = Резервы.Номенклатура
			И ОстаткиХз.Склад         = Резервы.Склад
			И ОстаткиХз.НарядЗаказ    = Резервы.НарядЗаказ
